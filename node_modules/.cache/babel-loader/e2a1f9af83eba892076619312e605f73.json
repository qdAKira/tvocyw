{"remainingRequest":"D:\\Git\\yangkou-balance-management-system\\node_modules\\thread-loader\\dist\\cjs.js!D:\\Git\\yangkou-balance-management-system\\node_modules\\babel-loader\\lib\\index.js!D:\\Git\\yangkou-balance-management-system\\src\\promission.js","dependencies":[{"path":"D:\\Git\\yangkou-balance-management-system\\src\\promission.js","mtime":1622625004935},{"path":"D:\\Git\\yangkou-balance-management-system\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1613790689000},{"path":"D:\\Git\\yangkou-balance-management-system\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1613790689000},{"path":"D:\\Git\\yangkou-balance-management-system\\node_modules\\babel-loader\\lib\\index.js","mtime":1613790689000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.filter\";\nimport _objectSpread from \"D:\\\\Git\\\\yangkou-balance-management-system\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/objectSpread\";\nimport \"core-js/modules/es6.array.some\";\nimport router from \"./router\";\n\nvar _import = require(\"./router/import.js\");\n\nvar getRouter;\nvar children = localStorage.getItem('fakeRouter');\nchildren = JSON.parse(children);\nvar fakeRouter = {\n  \"children\": children ? children : []\n};\nvar fakeRouterC = [];\nrouterDo(fakeRouter.children);\n\nfunction routerDo(array) {\n  console.log(array);\n\n  for (var i = 0; i < array.length; i++) {\n    if (array[i].children && array[i].children.length) {\n      routerDo(array[i].children);\n    } else {\n      fakeRouterC.push(array[i]);\n    }\n  }\n}\n\nif (sessionStorage.getItem('token') || localStorage.getItem('token')) {\n  getRouter = filterAsyncRouter(fakeRouterC);\n  router.options.routes[0].children = getRouter;\n  router.addRoutes(router.options.routes);\n}\n\nrouter.beforeEach(function (to, from, next) {\n  console.log(router);\n\n  if (to.meta.title) {\n    document.title = to.meta.title;\n  }\n\n  if (to.matched.some(function (record) {\n    return record.meta.requireAuth;\n  })) {\n    console.log(getRouter);\n\n    if (!sessionStorage.getItem('token') && !localStorage.getItem('token')) {\n      next({\n        path: '/login'\n      });\n    } else {\n      if (!getRouter) {\n        if (!getObjArr('children')) {\n          // axios\n          console.log(fakeRouter.children);\n          getRouter = fakeRouter.children; //假装模拟后台请求得到的路由数据\n\n          saveObjArr('children', getRouter); //存储路由到localStorage\n\n          routerGo(to, next); //执行路由跳转方法\n        } else {\n          //从localStorage拿到了路由\n          getRouter = getObjArr('children'); //拿到路由\n\n          routerGo(to, next);\n        }\n      } else {\n        if (to.path == '/') {\n          if (localStorage.getItem('roleID') == 3) {\n            next({\n              path: '/media/company'\n            });\n          } else {\n            next({\n              path: '/media/home'\n            });\n          }\n        } else {\n          next();\n        }\n      }\n    }\n  } else {\n    next();\n  }\n});\n\nfunction routerGo(to, next) {\n  getRouter = filterAsyncRouter(fakeRouterC); //过滤路由\n  // router.addRoutes(getRouter) //动态添加路由\n\n  router.options.routes[0].children = getRouter;\n  router.addRoutes(router.options.routes);\n  console.log(router);\n  global.antRouter = getRouter; //将路由数据传递给全局变量，做菜单渲染工作\n\n  console.log(global.antRouter);\n  next(_objectSpread({}, to, {\n    replace: true\n  }));\n}\n\nfunction saveObjArr(name, data) {\n  //localStorage 存储数组对象的方法\n  localStorage.setItem(name, JSON.stringify(data));\n}\n\nfunction getObjArr(name) {\n  //localStorage 获取数组对象的方法\n  return JSON.parse(window.localStorage.getItem(name));\n}\n\nfunction filterAsyncRouter(asyncRouterMap) {\n  //遍历后台传来的路由字符串，转换为组件对象\n  var accessedRouters = asyncRouterMap.filter(function (route) {\n    if (route.component) {\n      route.component = _import(route.component) || null;\n    }\n\n    if (route.children && route.children.length) {\n      route.children = filterAsyncRouter(route.children);\n    }\n\n    return true;\n  });\n  return accessedRouters;\n}",{"version":3,"sources":["D:\\Git\\yangkou-balance-management-system\\src\\promission.js"],"names":["router","_import","require","getRouter","children","localStorage","getItem","JSON","parse","fakeRouter","fakeRouterC","routerDo","array","console","log","i","length","push","sessionStorage","filterAsyncRouter","options","routes","addRoutes","beforeEach","to","from","next","meta","title","document","matched","some","record","requireAuth","path","getObjArr","saveObjArr","routerGo","global","antRouter","replace","name","data","setItem","stringify","window","asyncRouterMap","accessedRouters","filter","route","component"],"mappings":"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","sourcesContent":["import router from './router'\r\n\r\nconst _import = require('./router/import.js')\r\n\r\nlet getRouter\r\n\r\nlet children = localStorage.getItem('fakeRouter')\r\nchildren = JSON.parse(children)\r\n\r\nlet fakeRouter = {\r\n\t\"children\": children ? children : []\r\n}\r\n\r\nlet fakeRouterC = []\r\n\r\nrouterDo(fakeRouter.children)\r\n\r\nfunction routerDo(array) {\r\n\tconsole.log(array)\r\n\tfor (let i = 0; i < array.length; i++) {\r\n\t\tif (array[i].children && array[i].children.length) {\r\n\t\t\trouterDo(array[i].children)\r\n\t\t} else {\r\n\t\t\tfakeRouterC.push(array[i])\r\n\t\t}\r\n\t}\r\n}\r\n\r\nif (sessionStorage.getItem('token') || localStorage.getItem('token')) {\r\n\tgetRouter = filterAsyncRouter(fakeRouterC)\r\n\trouter.options.routes[0].children = getRouter\r\n\trouter.addRoutes(router.options.routes)\r\n}\r\n\r\nrouter.beforeEach((to, from, next) => {\r\n\tconsole.log(router)\r\n\tif (to.meta.title) {\r\n\t\tdocument.title = to.meta.title\r\n\t}\r\n\tif (to.matched.some(record => record.meta.requireAuth)) {\r\n\t\tconsole.log(getRouter)\r\n\t\tif (!sessionStorage.getItem('token') && !localStorage.getItem('token')) {\r\n\t\t\tnext({\r\n\t\t\t\tpath: '/login',\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tif (!getRouter) {\r\n\t\t\t\tif (!getObjArr('children')) {\r\n\t\t\t\t\t// axios\r\n\t\t\t\t\tconsole.log(fakeRouter.children)\r\n\t\t\t\t\tgetRouter = fakeRouter.children //假装模拟后台请求得到的路由数据\r\n\t\t\t\t\tsaveObjArr('children', getRouter) //存储路由到localStorage\r\n\t\t\t\t\trouterGo(to, next) //执行路由跳转方法\r\n\t\t\t\t} else { //从localStorage拿到了路由\r\n\t\t\t\t\tgetRouter = getObjArr('children') //拿到路由\r\n\t\t\t\t\trouterGo(to, next)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (to.path == '/') {\r\n\t\t\t\t\tif (localStorage.getItem('roleID') == 3) {\r\n\t\t\t\t\t\tnext({\r\n\t\t\t\t\t\t\tpath: '/media/company'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnext({\r\n\t\t\t\t\t\t\tpath: '/media/home'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnext()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tnext()\r\n\t}\r\n})\r\n\r\n\r\nfunction routerGo(to, next) {\r\n\tgetRouter = filterAsyncRouter(fakeRouterC) //过滤路由\r\n\t// router.addRoutes(getRouter) //动态添加路由\r\n\r\n\trouter.options.routes[0].children = getRouter\r\n\trouter.addRoutes(router.options.routes)\r\n\tconsole.log(router)\r\n\tglobal.antRouter = getRouter //将路由数据传递给全局变量，做菜单渲染工作\r\n\tconsole.log(global.antRouter)\r\n\tnext({\r\n\t\t...to,\r\n\t\treplace: true\r\n\t})\r\n}\r\n\r\nfunction saveObjArr(name, data) { //localStorage 存储数组对象的方法\r\n\tlocalStorage.setItem(name, JSON.stringify(data))\r\n}\r\n\r\nfunction getObjArr(name) { //localStorage 获取数组对象的方法\r\n\treturn JSON.parse(window.localStorage.getItem(name));\r\n\r\n}\r\n\r\nfunction filterAsyncRouter(asyncRouterMap) { //遍历后台传来的路由字符串，转换为组件对象\r\n\tconst accessedRouters = asyncRouterMap.filter(route => {\r\n\t\tif (route.component) {\r\n\t\t\troute.component = _import(route.component) || null\r\n\t\t}\r\n\t\tif (route.children && route.children.length) {\r\n\t\t\troute.children = filterAsyncRouter(route.children)\r\n\t\t}\r\n\t\treturn true\r\n\t})\r\n\r\n\treturn accessedRouters\r\n}\r\n"]}]}