{"remainingRequest":"D:\\Git\\yangkou-balance-management-system\\node_modules\\babel-loader\\lib\\index.js!D:\\Git\\yangkou-balance-management-system\\src\\promission.js","dependencies":[{"path":"D:\\Git\\yangkou-balance-management-system\\src\\promission.js","mtime":1607417762204},{"path":"D:\\Git\\yangkou-balance-management-system\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1606785092522},{"path":"D:\\Git\\yangkou-balance-management-system\\node_modules\\babel-loader\\lib\\index.js","mtime":1606785115728}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.filter\";\nimport _objectSpread from \"D:\\\\Git\\\\yangkou-balance-management-system\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/objectSpread\";\nimport \"core-js/modules/es6.array.some\";\nimport router from \"./router\";\nconsole.log(router);\n\nvar _import = require(\"./router/import.js\");\n\nvar getRouter;\nvar fakeRouter = {\n  \"children\": [{\n    \"path\": \"dashboard\",\n    \"component\": \"dashboard\",\n    \"meta\": {\n      \"title\": \"首页\",\n      \"requireAuth\": true\n    }\n  }, {\n    \"path\": \"xx\",\n    \"component\": \"xx\",\n    \"meta\": {\n      \"title\": \"xx\"\n    }\n  }]\n};\nrouter.beforeEach(function (to, from, next) {\n  console.log(to);\n  console.log(to.matched.some(function (record) {\n    return record.meta.requireAuth;\n  }));\n  console.log(sessionStorage.getItem('token'));\n  console.log(localStorage.getItem('token'));\n\n  if (to.matched.some(function (record) {\n    return record.meta.requireAuth;\n  })) {\n    if (!sessionStorage.getItem('token') && !localStorage.getItem('token')) {\n      next({\n        path: '/login',\n        query: {\n          redirect: to.fullPath\n        }\n      });\n    } else {\n      if (!getRouter) {\n        console.log(getObjArr('children'));\n\n        if (!getObjArr('children')) {\n          // axios\n          console.log(fakeRouter.children);\n          getRouter = fakeRouter.children; //假装模拟后台请求得到的路由数据\n\n          saveObjArr('children', getRouter); //存储路由到localStorage\n\n          routerGo(to, next); //执行路由跳转方法\n        } else {\n          //从localStorage拿到了路由\n          getRouter = getObjArr('children'); //拿到路由\n\n          routerGo(to, next);\n        }\n      } else {\n        next();\n      }\n    }\n  } else {\n    next();\n  }\n});\n\nfunction routerGo(to, next) {\n  getRouter = filterAsyncRouter(getRouter); //过滤路由\n\n  console.log(getRouter); // router.addRoutes(getRouter) //动态添加路由\n\n  router.options.routes[0].children = getRouter;\n  console.log(router);\n  router.addRoutes(router.options.routes);\n  global.antRouter = getRouter; //将路由数据传递给全局变量，做菜单渲染工作\n\n  next(_objectSpread({}, to, {\n    replace: true\n  }));\n}\n\nfunction saveObjArr(name, data) {\n  //localStorage 存储数组对象的方法\n  localStorage.setItem(name, JSON.stringify(data));\n}\n\nfunction getObjArr(name) {\n  //localStorage 获取数组对象的方法\n  return JSON.parse(window.localStorage.getItem(name));\n}\n\nfunction filterAsyncRouter(asyncRouterMap) {\n  //遍历后台传来的路由字符串，转换为组件对象\n  var accessedRouters = asyncRouterMap.filter(function (route) {\n    if (route.component) {\n      route.component = _import(route.component) || null;\n    }\n\n    if (route.children && route.children.length) {\n      route.children = filterAsyncRouter(route.children);\n    }\n\n    return true;\n  });\n  return accessedRouters;\n}",{"version":3,"sources":["D:\\Git\\yangkou-balance-management-system\\src\\promission.js"],"names":["router","console","log","_import","require","getRouter","fakeRouter","beforeEach","to","from","next","matched","some","record","meta","requireAuth","sessionStorage","getItem","localStorage","path","query","redirect","fullPath","getObjArr","children","saveObjArr","routerGo","filterAsyncRouter","options","routes","addRoutes","global","antRouter","replace","name","data","setItem","JSON","stringify","parse","window","asyncRouterMap","accessedRouters","filter","route","component","length"],"mappings":"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","sourcesContent":["import router from './router'\r\n\r\nconsole.log(router)\r\nconst _import = require('./router/import.js')\r\n\r\nlet getRouter\r\n\r\nlet fakeRouter = {\r\n\t\"children\": [{\r\n\t\t\"path\": \"dashboard\",\r\n\t\t\"component\": \"dashboard\",\r\n\t\t\"meta\": {\r\n\t\t\t\"title\": \"首页\",\r\n\t\t\t\"requireAuth\": true\r\n\t\t}\r\n\t}, {\r\n\t\t\"path\": \"xx\",\r\n\t\t\"component\": \"xx\",\r\n\t\t\"meta\": {\r\n\t\t\t\"title\": \"xx\",\r\n\t\t}\r\n\t}]\r\n}\r\n\r\nrouter.beforeEach((to, from, next) => {\r\n\tconsole.log(to)\r\n\tconsole.log(to.matched.some(record => record.meta.requireAuth))\r\n\tconsole.log(sessionStorage.getItem('token'))\r\n\tconsole.log(localStorage.getItem('token'))\r\n\t\r\n\tif (to.matched.some(record => record.meta.requireAuth)) {\r\n\t\tif (!sessionStorage.getItem('token') && !localStorage.getItem('token')) {\r\n\t\t\tnext({\r\n\t\t\t\tpath: '/login',\r\n\t\t\t\tquery: {\r\n\t\t\t\t\tredirect: to.fullPath\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tif (!getRouter) {\r\n\t\t\t\tconsole.log(getObjArr('children'))\r\n\t\t\t\tif (!getObjArr('children')) {\r\n\t\t\t\t\t// axios\r\n\t\t\t\t\tconsole.log(fakeRouter.children)\r\n\t\t\t\t\tgetRouter = fakeRouter.children //假装模拟后台请求得到的路由数据\r\n\t\t\t\t\tsaveObjArr('children', getRouter) //存储路由到localStorage\r\n\t\t\t\t\trouterGo(to, next) //执行路由跳转方法\r\n\t\t\t\t} else { //从localStorage拿到了路由\r\n\t\t\t\t\tgetRouter = getObjArr('children') //拿到路由\r\n\t\t\t\t\trouterGo(to, next)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tnext()\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tnext()\r\n\t}\r\n})\r\n\r\n\r\nfunction routerGo(to, next) {\r\n\tgetRouter = filterAsyncRouter(getRouter) //过滤路由\r\n\tconsole.log(getRouter)\r\n\t// router.addRoutes(getRouter) //动态添加路由\r\n\trouter.options.routes[0].children = getRouter\r\n\tconsole.log(router)\r\n\trouter.addRoutes(router.options.routes)\r\n\tglobal.antRouter = getRouter //将路由数据传递给全局变量，做菜单渲染工作\r\n\tnext({ ...to,\r\n\t\treplace: true\r\n\t})\r\n}\r\n\r\nfunction saveObjArr(name, data) { //localStorage 存储数组对象的方法\r\n\tlocalStorage.setItem(name, JSON.stringify(data))\r\n}\r\n\r\nfunction getObjArr(name) { //localStorage 获取数组对象的方法\r\n\treturn JSON.parse(window.localStorage.getItem(name));\r\n\r\n}\r\n\r\nfunction filterAsyncRouter(asyncRouterMap) { //遍历后台传来的路由字符串，转换为组件对象\r\n\tconst accessedRouters = asyncRouterMap.filter(route => {\r\n\t\tif (route.component) {\r\n\t\t\troute.component = _import(route.component) || null\r\n\t\t}\r\n\t\tif (route.children && route.children.length) {\r\n\t\t\troute.children = filterAsyncRouter(route.children)\r\n\t\t}\r\n\t\treturn true\r\n\t})\r\n\r\n\treturn accessedRouters\r\n}\n"]}]}